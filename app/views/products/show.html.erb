 <%= stylesheet_link_tag 'products_show', media: 'all', data: { turbolinks: false } %> 
<div class="container mt-4">
  <div class="row">
  <% if flash[:alert] %>
  <%= flash[:alert] %>
  <% elsif flash[:notice] %>
  <%= flash[:notice] %>
  <% end %>
  <% if @cart %>
    <div class="col-md-8"> <!-- Main product display section -->
    <% else %>
        <div class="col" style="width: 500px;"> <!-- Main product display section -->

    <% end %>
      <div class="card mb-4">
        <div class="card-header">
          <h1 class="h4"><%= @product.name %></h1>
        </div>
        <div class="card-body text-center">
                    <% if @product.img.attached? %>

<%= image_tag @product.img, class: 'img-fluid', style: 'max-width: 200px;', alt: @product.name %>
<% end %>
          <p class="mt-3"><%= @product.description %></p>
          <p class="h5">Price: <%= number_to_currency(@product.price, unit: 'â‚¹', format: '%u%n', delimiter: ',', precision: 2) %></p>
          <% if !current_user&.seller? %>
          <p class="h5">Sold by : <%= link_to @seller.first_name+" "+@seller.last_name ,products_path("seller_id": @seller.id)%></p>
          <% end %>
          <% if @product.stock_quantity<=0 %>
          <h4>Out of stock</h4>
          <% else %>
          <p class="h5">Stock : <%= @product.stock_quantity %></p>
          <% end %>
          <% if current_user.nil? %>
          <%= link_to 'Login for shopping' , new_user_session_path, class:"btn btn-danger" %>
          <% end %>
        </div>

        <% if @cart %>
        <div class="card-footer">
          <!-- Form for adding to cart -->
          <%= form_with url: line_items_path, method: :post, local: true do %>
            <div class="input-group mb-3">
              <select name="line_item[quantity]" class="form-select form-select-sm" style="margin-top: 10px" aria-label="Select quantity">
                <% (1..5).each do |num| %>
                  <option value="<%= num %>"><%= num %></option>
                <% end %>   
              </select>
              <% if @product.stock_quantity>0 %>
              <%= button_tag 'Add to Cart', type: 'submit', class: 'btn btn-primary' %>
              <% else %>
              <%= button_tag 'Add to Cart', type: 'submit', class: 'btn btn-primary',disabled:true %>
              <% end %>

            </div>
            <%= hidden_field_tag 'line_item[product_id]', @product.id %>
            <%= hidden_field_tag 'line_item[cart_id]', session[:cart_id] %>
            <%= hidden_field_tag 'line_item[order_id]', nil %>
            <%= hidden_field_tag 'line_item[price]', @product.price %>
            <%= hidden_field_tag 'line_item[status]', 'pending' %>
            
          <% end %>
        </div>
      </div>
    </div>

    <% end %>
  <% if @cart %>
    <div class="col-md-4"> 
      <div style="position: sticky; top: 20px;">
        <%= render 'carts/carts' %> 
      </div>
    </div>
  </div>
</div>



<% else %>

<% if current_user&.seller? && @product.seller == current_user %>
  <div class="text-center">
    <%= button_to "Remove Item", product_path(@product.id), method: :delete, data: { confirm: "Are you sure?" }, class: 'btn btn-danger' %>
    <br>
    <%= button_to "Update Item", edit_product_path(@product.id), method: :get, class: 'btn btn-danger' %>
  </div>
<% end %>


<% end %>
